# JavaScript Runtime

자바스크립트는 싱글 스레드, 논-블로킹 언어이다.

## 싱글 스레드

싱글 스레드는 하나의 힙 영역과 하나의 콜 스택을 가진다.

- 하나의 콜 스택을 가진다는 의미는 한번에 한가지 일 밖에 하지 못한다는 의미
- 네트워크 요청을 한다면, 응답이 올떄까지 다른 일을 하지 못하고 기다림

## 콜 스택

함수가 실행되는 순서를 기억하는 공간

- LIFO(Last In First Out)
- 함수를 실행하려면 스택의 가장 위에 해당 함수를 넣게 되고, 함수에서 리턴이 일어나면 스택의 가장 위쪽에서 함수를 꺼낸다 .

## 논-블로킹

싱글 스레드는 스택이 하나밖에 없기 떄문에, 한 번에 한 가지 일 밖에 할 수 없다.
예를 들어 네트워크 요청을 한다면 응답이 올떄까지 다른 일을 하지 못하고 기다릴뿐

### 블로킹

콜 스택이 멈춘 상태를 블로킹 상태라 한다.

- 블로킹 상태를 해결하는 방법은 논-블로킹, 비동기 콜백을 사용하는 것

## 자바스크립트 런타임

싱글 스레드인 자바스크립트가 setTimeout, ajax, Dom event 등 콜백으로 비동기 동작을 사용할수 있는 이유는 브라우저의 Web API의 도움 때문 (브라우저는 multi Thread 지원)

## Web API

Web API는 자바스크립트 엔진에서 정의되지 않았던 setTimeout이나 HTTP 요청 메서드, DOM 이벤트 등의 메서드를 지원한다.

## 테스크 큐

테스크백 큐는 Web API 결과값을 쌓아두는 큐이다.

예를 들어 자바스크립트에서 `setTimeout(cb, 5000)`를 호출하게 되면, Web API는 타이머를 동작시켜 5초 후에 콜백 큐에 `cb`를 쌓는다.

- FIFO(First In First Out)

## 이벤트 루프

이벤트 루프는 콜 스택과 콜백 큐를 관찰하는 역할을 한다.

콜 스택이 비어있으면 콜백 큐의 첫번쨰 콜백을 스택에 쌓는다.

## 마이크로 테스크 큐

우리가 흔히 쓰는 프로미스에 등록된 콜백

프로미스가 다 수행이 되고나면 그 다음에 등록한 then에 등록한 콜백함수
mutation observer api에 등록된 콜백함수가 들어있다.

## 렌더 큐

렌더 큐는 이벤트 큐와 유사하다.

렌더 큐와 이벤트 큐의 차이점은 렌더 큐가 이벤트 큐보다 더 높은 우선순위를 가진다.(렌더 큐의 콜백이 먼저 콜 스택에 들어가게 된다)는 점

브라우저는 1초에 60프레임 속도로 화면을 다시 그린다.(Repaint) 하지만 자바스크립트가 하는 일들로 인해 Repaint 작업이 영향을 받는다.
렌더도 큐에 쌓여있는 하나의 콜백처럼 동작하기 때문에, 콜 스택에 코드가 있으면 렌더링 하지 못한다.

느린 동기식 루프를 실행하면, 콜 스택에 코드가 쌓여있기 떄문에 렌더가 동작하지 않는다. 이벤트 루프를 막지 말라고 하는것이 이러한 현상을 뜻한다.

콜 스택에 쓸데없는 느린 코드를 쌓아서 브라우저가 할일(렌더링)을 못하게 하는 일이 없어야 한다. 단위가 큰 코드는 작은 단위로 쪼개거나, 오래 걸리는 작업들은 비동기로 동작시키는것이 좋다.
